<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DR CNAME Flip Portal</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);
            --color-green-500: rgba(34, 197, 94, 1);
            
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-slate-500-rgb: 98, 108, 113;
            --color-red-500-rgb: 192, 21, 47;
            --color-red-400-rgb: 255, 84, 89;
            --color-orange-500-rgb: 168, 75, 47;
            --color-green-500-rgb: 34, 197, 94;
            
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-green-500);
            --color-warning: var(--color-orange-500);
            --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
            
            --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-family-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-24: 24px;
            --space-32: 32px;
            --radius-base: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;
                
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
                --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-error: var(--color-red-400);
                --color-success: var(--color-teal-300);
                --color-warning: var(--color-orange-400);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
                --color-btn-primary-text: var(--color-slate-900);
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family-base);
            background-color: var(--color-background);
            color: var(--color-text);
            padding: var(--space-24);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: var(--space-32);
        }

        h1 {
            font-size: var(--font-size-3xl);
            font-weight: 600;
            margin-bottom: var(--space-8);
        }

        .subtitle {
            color: var(--color-text-secondary);
            font-size: var(--font-size-base);
        }

        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-24);
            margin-bottom: var(--space-24);
            box-shadow: var(--shadow-sm);
        }

        .card h2 {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--space-16);
        }

        .form-group {
            margin-bottom: var(--space-16);
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: var(--space-8);
            font-size: var(--font-size-sm);
        }

        input, select, textarea {
            width: 100%;
            padding: var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            background: var(--color-surface);
            color: var(--color-text);
            font-size: var(--font-size-base);
            font-family: var(--font-family-base);
        }

        input:focus, select:focus, textarea:focus {
            outline: 2px solid var(--color-primary);
            border-color: var(--color-primary);
        }

        .btn {
            padding: var(--space-12) var(--space-24);
            border: none;
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--color-secondary);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: var(--color-secondary-hover);
        }

        .status {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 999px;
            font-size: var(--font-size-sm);
            font-weight: 500;
            gap: 6px;
        }

        .status-pending {
            background: rgba(var(--color-orange-500-rgb), 0.15);
            color: var(--color-warning);
            border: 1px solid rgba(var(--color-orange-500-rgb), 0.25);
        }

        .status-approved {
            background: rgba(var(--color-green-500-rgb), 0.15);
            color: var(--color-success);
            border: 1px solid rgba(var(--color-green-500-rgb), 0.25);
        }

        .status-failed {
            background: rgba(var(--color-red-500-rgb), 0.15);
            color: var(--color-error);
            border: 1px solid rgba(var(--color-red-500-rgb), 0.25);
        }

        .status-completed {
            background: rgba(var(--color-green-500-rgb), 0.15);
            color: var(--color-success);
            border: 1px solid rgba(var(--color-green-500-rgb), 0.25);
        }

        .workflow-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: var(--space-16);
            padding: var(--space-16);
            background: var(--color-secondary);
            border-radius: var(--radius-base);
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: var(--space-12);
            flex-shrink: 0;
        }

        .step-content h3 {
            font-size: var(--font-size-base);
            font-weight: 600;
            margin-bottom: var(--space-8);
        }

        .step-content p {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin: 0;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-16);
            margin-bottom: var(--space-24);
        }

        .stat-card {
            padding: var(--space-16);
            background: var(--color-secondary);
            border-radius: var(--radius-base);
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-8);
        }

        .stat-value {
            font-size: var(--font-size-2xl);
            font-weight: 600;
        }

        .request-list {
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            overflow: hidden;
        }

        .request-item {
            padding: var(--space-16);
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .request-item:last-child {
            border-bottom: none;
        }

        .request-info {
            flex: 1;
        }

        .request-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .request-meta {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .code-block {
            background: var(--color-secondary);
            padding: var(--space-12);
            border-radius: var(--radius-base);
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
            overflow-x: auto;
            margin: var(--space-16) 0;
        }

        .alert {
            padding: var(--space-16);
            border-radius: var(--radius-base);
            margin-bottom: var(--space-16);
            display: flex;
            gap: var(--space-12);
        }

        .alert-warning {
            background: rgba(var(--color-orange-500-rgb), 0.15);
            border: 1px solid rgba(var(--color-orange-500-rgb), 0.25);
            color: var(--color-text);
        }

        .alert-info {
            background: rgba(var(--color-teal-500-rgb), 0.15);
            border: 1px solid rgba(var(--color-teal-500-rgb), 0.25);
            color: var(--color-text);
        }

        .tabs {
            display: flex;
            gap: var(--space-8);
            border-bottom: 1px solid var(--color-border);
            margin-bottom: var(--space-24);
        }

        .tab {
            padding: var(--space-12) var(--space-16);
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: var(--font-size-base);
            color: var(--color-text-secondary);
            font-weight: 500;
        }

        .tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .actions {
            display: flex;
            gap: var(--space-12);
            margin-top: var(--space-16);
        }

        .mermaid-container {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            padding: var(--space-24);
            margin: var(--space-16) 0;
            overflow-x: auto;
        }

        .mermaid-container svg {
            max-width: 100%;
            height: auto;
        }

        table {
            font-size: var(--font-size-sm);
        }

        table th {
            background: var(--color-secondary);
        }

        table tbody tr:hover {
            background: var(--color-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>DR CNAME Flip Portal</h1>
            <p class="subtitle">GitOps-integrated disaster recovery with deployment consistency</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('flip')">CNAME Flip</button>
            <button class="tab" onclick="switchTab('requests')">Pending Requests</button>
            <button class="tab" onclick="switchTab('workflow')">Workflow</button>
            <button class="tab" onclick="switchTab('config')">Configuration</button>
        </div>

        <div id="flip-tab" class="tab-content active">
            <div class="grid">
                <div class="stat-card">
                    <div class="stat-label">Active CNAMEs</div>
                    <div class="stat-value">12</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Pending Flips</div>
                    <div class="stat-value">2</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Last Flip</div>
                    <div class="stat-value">2h ago</div>
                </div>
            </div>

            <div class="card">
                <h2>Request CNAME Flip</h2>
                
                <div class="alert alert-info">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                    <div>This will create a GitLab merge request updating Terraform configs and deployment.yaml files. Changes will be applied after approval.</div>
                </div>

                <form id="cnameForm">
                    <div class="form-group">
                        <label for="service">Service/Application</label>
                        <select id="service" required>
                            <option value="">Select a service...</option>
                            <option value="api-gateway">API Gateway (api.example.com)</option>
                            <option value="web-app">Web Application (app.example.com)</option>
                            <option value="payment">Payment Service (payment.example.com)</option>
                            <option value="auth">Auth Service (auth.example.com)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="currentTarget">Current Target</label>
                        <input type="text" id="currentTarget" value="prod-dc1.example.com" readonly>
                    </div>

                    <div class="form-group">
                        <label for="operationType">Operation Type</label>
                        <select id="operationType" required onchange="toggleOperationFields()">
                            <option value="flip">Flip CNAME to New Target</option>
                            <option value="delete">Delete CNAME</option>
                            <option value="create">Create New CNAME</option>
                        </select>
                    </div>

                    <div class="form-group" id="newTargetGroup">
                        <label for="newTarget">New DR Target</label>
                        <select id="newTarget">
                            <option value="">Select DR site...</option>
                            <option value="dr-dc2.example.com">DR Site 2 (dr-dc2.example.com)</option>
                            <option value="dr-dc3.example.com">DR Site 3 (dr-dc3.example.com)</option>
                            <option value="cloud-dr.example.com">Cloud DR (cloud-dr.example.com)</option>
                        </select>
                    </div>

                    <div class="form-group" id="customTargetGroup" style="display: none;">
                        <label for="customTarget">Custom Target (for new CNAME)</label>
                        <input type="text" id="customTarget" placeholder="custom-target.example.com">
                    </div>

                    <div class="form-group" id="newCnameGroup" style="display: none;">
                        <label for="newCname">New CNAME</label>
                        <input type="text" id="newCname" placeholder="new-service.example.com">
                    </div>

                    <div class="form-group">
                        <label for="reason">Reason for Flip</label>
                        <textarea id="reason" rows="3" placeholder="Describe the DR scenario..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="gitlabProject">GitLab Project</label>
                        <input type="text" id="gitlabProject" value="infrastructure/terraform-dns" readonly>
                    </div>

                    <div class="form-group">
                        <label for="approvers">Require Approval From</label>
                        <select id="approvers" multiple size="3">
                            <option value="ops-lead" selected>Ops Lead</option>
                            <option value="platform-eng" selected>Platform Engineering</option>
                            <option value="sre-team">SRE Team</option>
                        </select>
                    </div>

                    <div class="actions">
                        <button type="submit" class="btn btn-primary">Create Flip Request</button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">Reset</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="requests-tab" class="tab-content">
            <div class="card">
                <h2>Pending CNAME Flip Requests</h2>
                <div class="request-list" id="requestList">
                    <div class="request-item">
                        <div class="request-info">
                            <div class="request-title">API Gateway → DR Site 2</div>
                            <div class="request-meta">Requested by: john.doe | 15 minutes ago | MR #1234</div>
                        </div>
                        <span class="status status-pending">Pending Approval</span>
                    </div>
                    <div class="request-item">
                        <div class="request-info">
                            <div class="request-title">Payment Service → Cloud DR</div>
                            <div class="request-meta">Requested by: jane.smith | 1 hour ago | MR #1235</div>
                        </div>
                        <span class="status status-approved">Approved - Deploying</span>
                    </div>
                    <div class="request-item">
                        <div class="request-info">
                            <div class="request-title">Web Application → DR Site 3</div>
                            <div class="request-meta">Requested by: bob.wilson | 3 hours ago | MR #1230</div>
                        </div>
                        <span class="status status-completed">Completed</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Latest Merge Request Preview</h2>
                <div class="alert alert-warning">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    <div>Review changes carefully before approving. Both DNS and deployment configs will be updated.</div>
                </div>
                <div class="code-block">
                    <strong>terraform/dns.tf</strong><br>
                    - target = "prod-dc1.example.com"<br>
                    + target = "dr-dc2.example.com"<br><br>
                    <strong>k8s/deployment.yaml</strong><br>
                    - BACKEND_URL: "https://prod-dc1.example.com"<br>
                    + BACKEND_URL: "https://dr-dc2.example.com"
                </div>
            </div>
        </div>

        <div id="workflow-tab" class="tab-content">
            <div class="card">
                <h2>Approach 1: GitOps with IaC Consistency (Recommended)</h2>
                <p style="margin-bottom: 16px; color: var(--color-text-secondary);">Ansible orchestrates both DNS changes and deployment.yaml updates through GitLab, maintaining full consistency.</p>
                
                <div id="mermaid1" class="mermaid-container"></div>
            </div>

            <div class="card">
                <h2>Approach 2: Direct DNS Change (Simple)</h2>
                <p style="margin-bottom: 16px; color: var(--color-text-secondary);">Ansible performs DNS operations directly. Application teams manually sync deployment.yaml files.</p>
                
                <div class="alert alert-warning">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    <div><strong>Risk:</strong> Manual deployment.yaml updates can cause drift between DNS state and application configs. Requires strict operational discipline.</div>
                </div>
                
                <div id="mermaid2" class="mermaid-container"></div>
            </div>

            <div class="card">
                <h2>Comparison Matrix</h2>
                <table style="width: 100%; border-collapse: collapse; margin-top: 16px;">
                    <thead>
                        <tr style="border-bottom: 2px solid var(--color-border);">
                            <th style="text-align: left; padding: 12px; font-weight: 600;">Aspect</th>
                            <th style="text-align: left; padding: 12px; font-weight: 600;">Approach 1: GitOps</th>
                            <th style="text-align: left; padding: 12px; font-weight: 600;">Approach 2: Direct</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--color-border);">
                            <td style="padding: 12px; font-weight: 500;">Consistency</td>
                            <td style="padding: 12px; color: var(--color-success);">✓ Guaranteed</td>
                            <td style="padding: 12px; color: var(--color-error);">✗ Manual</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--color-border);">
                            <td style="padding: 12px; font-weight: 500;">Speed</td>
                            <td style="padding: 12px; color: var(--color-warning);">~5-10 min (approval + CI)</td>
                            <td style="padding: 12px; color: var(--color-success);">✓ ~1-2 min</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--color-border);">
                            <td style="padding: 12px; font-weight: 500;">Audit Trail</td>
                            <td style="padding: 12px; color: var(--color-success);">✓ Full (Git history)</td>
                            <td style="padding: 12px; color: var(--color-warning);">△ Partial</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--color-border);">
                            <td style="padding: 12px; font-weight: 500;">Rollback</td>
                            <td style="padding: 12px; color: var(--color-success);">✓ Git revert</td>
                            <td style="padding: 12px; color: var(--color-error);">✗ Manual</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--color-border);">
                            <td style="padding: 12px; font-weight: 500;">Complexity</td>
                            <td style="padding: 12px; color: var(--color-warning);">△ Higher</td>
                            <td style="padding: 12px; color: var(--color-success);">✓ Lower</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; font-weight: 500;">Risk of Drift</td>
                            <td style="padding: 12px; color: var(--color-success);">✓ None</td>
                            <td style="padding: 12px; color: var(--color-error);">✗ High</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="config-tab" class="tab-content">
            <div class="card">
                <h2>Integration Configuration</h2>
                
                <div class="form-group">
                    <label for="bluecatUrl">BlueCat Address Manager URL</label>
                    <input type="text" id="bluecatUrl" value="https://bluecat.example.com" placeholder="https://bluecat.example.com">
                </div>

                <div class="form-group">
                    <label for="gitlabUrl">GitLab Instance URL</label>
                    <input type="text" id="gitlabUrl" value="https://gitlab.example.com" placeholder="https://gitlab.example.com">
                </div>

                <div class="form-group">
                    <label for="gitlabToken">GitLab API Token</label>
                    <input type="password" id="gitlabToken" placeholder="glpat-xxxxxxxxxxxxxxxxxxxx">
                </div>

                <div class="form-group">
                    <label for="terraformRepo">Terraform Repository</label>
                    <input type="text" id="terraformRepo" value="infrastructure/terraform-dns" placeholder="group/project">
                </div>

                <div class="form-group">
                    <label for="deploymentRepos">Deployment Repositories (comma-separated)</label>
                    <textarea id="deploymentRepos" rows="3" placeholder="apps/api-gateway,apps/web-app,apps/payment">apps/api-gateway,apps/web-app,apps/payment</textarea>
                </div>

                <div class="form-group">
                    <label for="approvalRules">Required Approvals</label>
                    <input type="number" id="approvalRules" value="2" min="1" max="5">
                </div>

                <div class="form-group">
                    <label for="lockTimeout">Deployment Lock Timeout (minutes)</label>
                    <input type="number" id="lockTimeout" value="30" min="5" max="120">
                </div>

                <div class="actions">
                    <button class="btn btn-primary" onclick="saveConfig()">Save Configuration</button>
                    <button class="btn btn-secondary" onclick="testConnections()">Test Connections</button>
                </div>
            </div>

            <div class="card">
                <h2>Backend Implementation Requirements</h2>
                <div class="code-block">
<strong>Python Dependencies:</strong>
- Flask/FastAPI (web framework)
- python-gitlab (GitLab API client)
- bluecat-libraries (BlueCat Python API)
- pyyaml (YAML parsing)
- requests (HTTP client)

<strong>Environment Variables:</strong>
BLUECAT_URL=https://bluecat.example.com
BLUECAT_USERNAME=admin
BLUECAT_PASSWORD=xxx
GITLAB_URL=https://gitlab.example.com
GITLAB_TOKEN=glpat-xxx
TERRAFORM_PROJECT=infrastructure/terraform-dns
DEPLOYMENT_PROJECTS=apps/api-gateway,apps/web-app
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'default',
            themeVariables: {
                primaryColor: '#21808D',
                primaryTextColor: '#134252',
                primaryBorderColor: '#1D7480',
                lineColor: '#5E5240',
                secondaryColor: '#32B8C6',
                tertiaryColor: '#FCFCF9'
            }
        });

        // Render Mermaid diagrams after page load
        document.addEventListener('DOMContentLoaded', function() {
            renderMermaidDiagrams();
        });

        function renderMermaidDiagrams() {
            // Approach 1: GitOps with full consistency
            const diagram1 = `
graph TB
    User[👤 User via Portal] -->|1. Submit Request| Portal[🖥️ Web Portal<br/>Frontend]
    Portal -->|2. Trigger Playbook| Ansible[⚙️ Ansible Controller]
    
    Ansible -->|3. Fetch Credentials| CyberArk[🔐 CyberArk]
    CyberArk -->|4. Return GitLab Token| Ansible
    
    Ansible -->|5. Clone Terraform Repo| GitLab1[📦 GitLab<br/>Terraform Repos]
    Ansible -->|6. Create Feature Branch| GitLab1
    
    Ansible -->|7. Update DNS Config| TFFile[📄 terraform/bluecat.tf<br/>CNAME resource]
    Ansible -->|8. Scan & Update| YAMLFile[📄 deployment.yaml<br/>DNS references]
    
    Ansible -->|9. Commit & Push| GitLab1
    Ansible -->|10. Create Merge Request| MR[🔀 GitLab MR]
    
    MR -->|11. Trigger CI Pipeline| Pipeline[🔄 GitLab CI/CD]
    Pipeline -->|12. Terraform Plan| TFPlan[terraform plan]
    Pipeline -->|13. YAML Lint| YAMLLint[yamllint validation]
    Pipeline -->|14. Dependency Check| DepCheck[Check VM dependencies]
    
    Pipeline -->|15. Request Approval| Approver[👥 Application Ops Team]
    Approver -->|16. Review & Approve| MR
    
    MR -->|17. Auto-merge| Main[main branch]
    Main -->|18. Trigger Deploy Pipeline| Deploy[🚀 Deployment Pipeline]
    
    Deploy -->|19. Terraform Apply| BlueCat[☁️ BlueCat DNS]
    BlueCat -->|20. Update CNAME| DNS[DNS Records Updated]
    
    Deploy -->|21. Sync Changes| ArgoCD[🔄 ArgoCD/Flux]
    ArgoCD -->|22. Update Workloads| K8s[☸️ Kubernetes Clusters]
    
    Deploy -->|23. Notify| Notification[📧 Slack/Email<br/>Audit Log]
    
    style Ansible fill:#32B8C6,stroke:#1D7480,color:#134252
    style CyberArk fill:#E68161,stroke:#A84B2F,color:#fff
    style MR fill:#21808D,stroke:#1A6873,color:#fff
    style Approver fill:#FFA500,stroke:#FF8C00,color:#fff
    style BlueCat fill:#32B8C6,stroke:#1D7480,color:#134252
    style K8s fill:#21808D,stroke:#1A6873,color:#fff
            `;

            // Approach 2: Direct DNS change
            const diagram2 = `
graph TB
    User[👤 User via Portal] -->|1. Submit Request| Portal[🖥️ Web Portal<br/>Frontend]
    Portal -->|2. Trigger Playbook| Ansible[⚙️ Ansible Controller]
    
    Ansible -->|3. Fetch Credentials| CyberArk[🔐 CyberArk]
    CyberArk -->|4. Return BlueCat Creds| Ansible
    
    Ansible -->|5. Execute DNS Operation| Decision{Operation Type}
    
    Decision -->|FLIP| Flip[Update CNAME Target]
    Decision -->|DELETE| Delete[Remove CNAME Record]
    Decision -->|ADD| Add[Create New CNAME]
    
    Flip -->|6. API Call| BlueCat[☁️ BlueCat API]
    Delete -->|6. API Call| BlueCat
    Add -->|6. API Call| BlueCat
    
    BlueCat -->|7. Confirm Change| Ansible
    Ansible -->|8. Log Operation| AuditLog[📋 Audit Log<br/>Operation recorded]
    
    Ansible -->|9. Notify Success| User
    Ansible -->|10. Alert Ops Team| Notification[📧 Notification<br/>DNS changed - YAML sync required]
    
    Notification -.->|Manual Action Required| AppTeam[👥 Application Team]
    AppTeam -.->|11. Manual Update| YAMLRepo[📦 GitLab<br/>App Repos]
    AppTeam -.->|12. Update deployment.yaml| YAMLFile[📄 deployment.yaml]
    AppTeam -.->|13. Create MR| AppMR[🔀 Application MR]
    AppTeam -.->|14. Deploy| AppDeploy[Update K8s configs]
    
    Warning[⚠️ RISK: Manual sync can cause drift<br/>between DNS and deployment state]
    
    style Ansible fill:#32B8C6,stroke:#1D7480,color:#134252
    style CyberArk fill:#E68161,stroke:#A84B2F,color:#fff
    style BlueCat fill:#32B8C6,stroke:#1D7480,color:#134252
    style Decision fill:#FFA500,stroke:#FF8C00,color:#fff
    style Warning fill:#FF5459,stroke:#C0152F,color:#fff
    style AppTeam fill:#FFA500,stroke:#FF8C00,color:#fff
    linkStyle 10,11,12,13,14 stroke:#FF5459,stroke-width:2px,stroke-dasharray: 5 5
            `;

            // Render diagrams
            mermaid.render('mermaid-graph-1', diagram1).then(({svg}) => {
                document.getElementById('mermaid1').innerHTML = svg;
            });

            mermaid.render('mermaid-graph-2', diagram2).then(({svg}) => {
                document.getElementById('mermaid2').innerHTML = svg;
            });
        }

        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function toggleOperationFields() {
            const operationType = document.getElementById('operationType').value;
            const newTargetGroup = document.getElementById('newTargetGroup');
            const customTargetGroup = document.getElementById('customTargetGroup');
            const newCnameGroup = document.getElementById('newCnameGroup');
            const newTargetField = document.getElementById('newTarget');
            const customTargetField = document.getElementById('customTarget');
            const newCnameField = document.getElementById('newCname');
            
            // Reset required attributes
            newTargetField.removeAttribute('required');
            customTargetField.removeAttribute('required');
            newCnameField.removeAttribute('required');
            
            // Show/hide fields based on operation type
            if (operationType === 'flip') {
                newTargetGroup.style.display = 'block';
                customTargetGroup.style.display = 'none';
                newCnameGroup.style.display = 'none';
                newTargetField.setAttribute('required', 'required');
            } else if (operationType === 'delete') {
                newTargetGroup.style.display = 'none';
                customTargetGroup.style.display = 'none';
                newCnameGroup.style.display = 'none';
            } else if (operationType === 'create') {
                newTargetGroup.style.display = 'none';
                customTargetGroup.style.display = 'block';
                newCnameGroup.style.display = 'block';
                customTargetField.setAttribute('required', 'required');
                newCnameField.setAttribute('required', 'required');
            }
        }

        document.getElementById('cnameForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const service = document.getElementById('service').value;
            const operationType = document.getElementById('operationType').value;
            const newTarget = document.getElementById('newTarget').value;
            const customTarget = document.getElementById('customTarget').value;
            const newCname = document.getElementById('newCname').value;
            const reason = document.getElementById('reason').value;
            
            if (!service || !reason) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Validate based on operation type
            if (operationType === 'flip' && !newTarget) {
                alert('Please select a new DR target');
                return;
            }
            
            if (operationType === 'create' && (!customTarget || !newCname)) {
                alert('Please provide both new CNAME and target');
                return;
            }
            
            // Simulate creating a flip request
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating Merge Request...';
            
            setTimeout(() => {
                // Add new request to the list
                const requestList = document.getElementById('requestList');
                const newRequest = document.createElement('div');
                newRequest.className = 'request-item';
                
                let operationTitle = '';
                if (operationType === 'flip') {
                    operationTitle = `${service} → ${newTarget}`;
                } else if (operationType === 'delete') {
                    operationTitle = `Delete CNAME: ${service}`;
                } else if (operationType === 'create') {
                    operationTitle = `Create: ${newCname} → ${customTarget}`;
                }
                
                newRequest.innerHTML = `
                    <div class="request-info">
                        <div class="request-title">${operationTitle}</div>
                        <div class="request-meta">Requested by: current.user | Just now | MR #${Math.floor(Math.random() * 1000) + 1200}</div>
                    </div>
                    <span class="status status-pending">Pending Approval</span>
                `;
                requestList.insertBefore(newRequest, requestList.firstChild);
                
                // Reset form and show success
                submitBtn.disabled = false;
                submitBtn.textContent = 'Create Flip Request';
                
                const operationText = operationType === 'flip' ? 'Flip' : operationType === 'delete' ? 'Delete' : 'Create';
                alert(`✓ ${operationText} request created successfully!\n\nMerge Request #` + (Math.floor(Math.random() * 1000) + 1200) + ' has been created in GitLab.\nApprovers have been notified.');
                
                // Switch to requests tab
                switchTab('requests');
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.querySelectorAll('.tab')[0].classList.remove('active');
                
                resetForm();
            }, 2000);
        });

        function resetForm() {
            document.getElementById('cnameForm').reset();
            document.getElementById('currentTarget').value = 'prod-dc1.example.com';
            document.getElementById('gitlabProject').value = 'infrastructure/terraform-dns';
            toggleOperationFields(); // Reset field visibility
        }

        function saveConfig() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Saving...';
            
            setTimeout(() => {
                btn.disabled = false;
                btn.textContent = 'Save Configuration';
                alert('✓ Configuration saved successfully');
            }, 1000);
        }

        function testConnections() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Testing...';
            
            setTimeout(() => {
                btn.disabled = false;
                btn.textContent = 'Test Connections';
                alert('✓ Connection Tests:\n\n• BlueCat API: Connected\n• GitLab API: Connected\n• Terraform Backend: Accessible\n\nAll systems operational');
            }, 2000);
        }

        // Auto-update current target when service changes
        document.getElementById('service').addEventListener('change', function(e) {
            const targets = {
                'api-gateway': 'prod-dc1-api.example.com',
                'web-app': 'prod-dc1-web.example.com',
                'payment': 'prod-dc1-payment.example.com',
                'auth': 'prod-dc1-auth.example.com'
            };
            
            const currentTarget = document.getElementById('currentTarget');
            currentTarget.value = targets[e.target.value] || 'prod-dc1.example.com';
        });
    </script>
</body>
</html>
